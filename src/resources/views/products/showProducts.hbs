<div class="paginationHeader">
    <a href="/">Trang chủ</a>/<a href="/products">Sản phẩm</a>/<p style="color:#555">{{products.name}}</p>
</div>
<div class="container mt-5">
    <div class="productsBody">
        <div class="slide_imgProducts">
            <div class="slide_column">
                <a class="oi oi-chevron-top"></a>
                <div class="list_img">
                    {{#each products.imageProducts}}
                    <div class="imgBox {{{checkActive @index}}}">
                        <img src="/img/products/{{this}}" alt="{{@index}}" class="slide_img">
                    </div>
                    {{/each}}
                </div>
                <a class="oi oi-chevron-bottom"></a>
            </div>
            <div class="slide_row">
                {{#each products.imageProducts}}
                <div class="imgBox">
                    <img src="/img/products/{{this}}" name="img" alt="{{@index}}" class="slide_img">
                </div>
                {{/each}}
                <div class="control_slide">
                    <a class="oi oi-chevron-left"></a>
                    <a class="oi oi-chevron-right"></a>
                </div>
            </div>
        </div>
        <div class="info_products">
            <h1 class="nameProdcuts" data-id="{{products.slug}}">{{products.name}}</h1>
            <span class="stroke"></span>
            <p class="priceProducts">{{products.price}} đ</p>
            <span class="stroke"></span>
            <ul class="list_color">
                <h5 class="listHeading">Màu sắc:</h5>
                {{#each products.color}}
                <li class="colorProducts" value="{{this}}">{{this}}</li>
                {{/each}}
            </ul>
            <ul class="list_size">
                <h5 class="listHeading">Kích thước:</h5>
                {{#each products.size}}
                <li class="sizeProducts">{{this}}</li>
                {{/each}}
            </ul>
            <button type="button" class="btn btn-dark addCartProducts">Thêm vào giỏ hàng</button>
        </div>
    </div>
</div>

<script>
    var transition = 0
    function controlSlide(next, prev, length, element, type, length2, element2, type2) {
        const img_slideRow = [...document.querySelectorAll(`${element} .imgBox`)]
        const img_slideColumn = [...document.querySelectorAll(`${element2} .imgBox`)]
        document.querySelector(next).onclick = () => {
            transition = (transition + 1)
            if (transition >= img_slideRow.length - 1) {
                transition = img_slideRow.length - 1
            }
            transformSlide(img_slideRow, img_slideColumn, type, type2, length, length2)
        }
        document.querySelector(prev).onclick = () => {
            transition = (transition - 1)
            if (transition <= 0) {
                transition = 0
            }
            transformSlide(img_slideRow, img_slideColumn, type, type2, length, length2)
        }

        img_slideColumn.map(img => {
            transformSlide(img_slideRow, img_slideColumn, type, type2, length, length2)
            img.onclick = () => {
                transition = Number(img.children[0].alt)
                transformSlide(img_slideRow, img_slideColumn, type, type2, length, length2)
            }
        })

    }

    function transformSlide(list_imgRow, list_imgColumn, type, type2, length, length2) {
        list_imgRow.map(img => {
            img.style.transform = `translate${type}(-${transition * length}px)`
        })
        list_imgColumn.map(img => {
            list_imgColumn.length <= 3 ? '' : img.style.transform = `translate${type2}(-${transition * length2}px)`
            img.classList.remove('active');
            if (Number(img.children[0].alt) == transition) {
                img.classList.add('active')
            }
        })
    }

    controlSlide('.control_slide .oi-chevron-right', '.control_slide .oi-chevron-left', 635, '.slide_row', 'X', 110, '.slide_column', 'Y')
    controlSlide('.slide_column .oi-chevron-bottom', '.slide_column .oi-chevron-top', 635, '.slide_row', 'X', 110, '.slide_column', 'Y')

    function chooseType(element) {
        const listType = [...document.querySelectorAll(element)]
        listType.map((type, index) => {
            index == 0 ? type.classList.add('active') : ''
            type.onclick = () => {
                let active = document.querySelector(`${element}.active`)
                active ? active.classList.remove('active') : ''
                type.classList.add('active')
            }
        })
    }

    chooseType('.colorProducts')
    chooseType('.sizeProducts')

    const btn_addCart = document.querySelector('.addCartProducts')
    btn_addCart.onclick = () => {
        let count = 0
        count++
        const colorProducts = document.querySelector('.colorProducts.active').innerText
        const priceProducts = document.querySelector('.priceProducts').innerText
        const sizeProducts = document.querySelector('.sizeProducts.active').innerText
        const slugProducts = document.querySelector('.nameProdcuts').getAttribute('data-id')
        const nameProducts = document.querySelector('.nameProdcuts').innerText
        const img = document.querySelectorAll('.slide_img')[transition].src.split('/')[5]
        const cartList = document.querySelector('.cart_list')
        const li = document.createElement('li')
        li.classList.add('cart_item')
        li.innerHTML = `<div class="cart_item-img">
                                <img src="/img/products/${img}" alt="img" class="item_img">
                            </div>
                            <div class="cart_item-info">
                                <a href="/products/${slugProducts}" class="item_name">${nameProducts}</a>
                                <span class="item_type">${colorProducts} / ${sizeProducts}</span>
                                <span class="item_price">${priceProducts}</span>
                                <p class="item_count"><span>-</span> <strong contenteditable="true">${count}</strong>
                                    <span>+</span></pcl>
                            </div>
                            <a href="" style="color:black" class="oi oi-trash mr-3"></a>`
        const list_item = [...document.querySelectorAll('.cart_item')]
        if (list_item.length != 0) {
            const check = list_item.filter(item => {
                if (item.querySelector('.item_name').innerText == nameProducts &&
                    item.querySelector('.item_type').innerText == colorProducts + ' / ' + sizeProducts) {
                    return true
                }
            })
            if(check.length != 0){
                if(Number(check[0].querySelector('.item_count strong').innerText) == 10){
                    alert('Số lượng 1 lần mua đã đạt giới hạn vui lòng liên hệ hotline để được giúp đỡ !')
                }
                else{
                    check[0].querySelector('.item_count strong').innerText = Number(check[0].querySelector('.item_count strong').innerText) + 1
                }
            }
            else{
                cartList.appendChild(li)
                document.querySelector('.cartBox').classList.add('show')
            }
        }
        else {
            cartList.appendChild(li)
                document.querySelector('.cartBox').classList.add('show')
        }
        const control = [...document.querySelectorAll('.item_count span')]
        if (control.length > 0) {
            control.map((btn, index) => {
                if (index == 0) {
                    btn.onclick = () => {
                        const count = Number(btn.parentElement.children[1].innerText)
                        if (count == 1) {
                            cartList.removeChild(btn.parentElement.parentElement.parentElement)
                        }
                        else {
                            btn.parentElement.children[1].innerText = count - 1
                        }
                    }
                }
                else {
                    btn.onclick = () => {
                        const count = Number(btn.parentElement.children[1].innerText)
                        if (count == 10) {
                            alert('Số lượng 1 lần mua đã đạt giới hạn vui lòng liên hệ hotline để được giúp đỡ !')
                        }
                        else {
                            btn.parentElement.children[1].innerText = count + 1
                        }
                    }
                }
            })
        }
    }

</script>